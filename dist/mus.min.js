!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Mus=e()}(this,function(){"use strict";function t(){void 0===this?console.error('Have you initialized Mus with "new" statement? (i.e. var mus = new Mus())'):(this.frames=[],this.timeouts=[],this.pos=0,this.currPos=0,this.startedAt=0,this.finishedAt=0,this.timePoint=!1,this.recordInputs=!0,this.recordCurrentElem=!1,this.curElemXPath=null,this.curElemCSSPath=null,this.recording=!1,this.playing=!1,this.playbackSpeed=this.speed.NORMAL,this.observer="",this.curWindowResizeEventListener=null,this.window={width:window.outerWidth,height:window.outerHeight},this.onmousemove=window.onmousemove,this.onmousedown=window.onmousedown,this.onscroll=window.onscroll,this.inputWithUserKeyEvent=()=>{document.querySelectorAll("textarea, input[type=text], input[type=email], input[type=number], input[type=tel], input[type=search], input[type=url], input[type=search], input[type=week], input[type=month], input[type=datetime-local]").forEach(t=>{t.onkeydown=null})},this.inputWithOnchangeEvent=()=>{document.querySelectorAll("select, input[type=checkbox], input[type=radio], input[type=color], input[type=date], input[type=file], input[type=number], input[type=range], input[type=time]").forEach(t=>{t.onchange=null})})}return t.prototype={windowResizeListener:function(i){return function(t){var e;i&&(e=["w",window.innerWidth,window.innerHeight],i(e))}},moveListener:function(n){var o=this;return function(t){var e,i;n&&(e=["m",t.clientX,t.clientY],o.recordCurrentElem&&(i=o.getXpathFromElement(t.target),e.push(o.curElemXPath===i?null:i),t=o.getCSSPath(t.target),e.push(o.curElemCSSPath===t?null:t),o.curElemXPath=i,o.curElemCSSPath=t),n(e))}},clickListener:function(i){var n=this;return function(t){var e;i&&(e=["c",t.clientX,t.clientY],n.recordCurrentElem&&(e.push(n.getXpathFromElement(t.target)),e.push(n.getCSSPath(t.target))),i(e))}},scrollListener:function(e){return function(t){e&&e(["s",document.scrollingElement.scrollLeft,document.scrollingElement.scrollTop])}},inputWithUserKeyListener:function(e){var i=this;return function(t){e&&e(["i",i.getXpathFromElement(t.target),i.getCSSPath(t.target),t.target.value])}},inputWithOnchangeListener:function(e){var i=this;return function(t){e&&e(["o",i.getXpathFromElement(t.target),i.getCSSPath(t.target),t.target.value])}},mutationObserver:function(e){return function(t){e&&e(t)}},record:function(n){var o,t,e,i;this.recording||(0==(o=this).startedAt&&(o.startedAt=(new Date).getTime()/1e3),o.timePoint?o.frames.push(["s",document.scrollingElement.scrollLeft,document.scrollingElement.scrollTop,0]):o.frames.push(["s",document.scrollingElement.scrollLeft,document.scrollingElement.scrollTop]),o.recordInputs&&(document.querySelectorAll("textarea, input[type=text], input[type=email], input[type=number], input[type=tel], input[type=search], input[type=url], input[type=search], input[type=week], input[type=month], input[type=datetime-local]").forEach(t=>{o.timePoint?o.frames.push(["i",o.getXpathFromElement(t),o.getCSSPath(t),t.value,0]):o.frames.push(["i",o.getXpathFromElement(t),o.getCSSPath(t),t.value])}),document.querySelectorAll("select, input[type=checkbox], input[type=radio], input[type=color], input[type=date], input[type=file], input[type=number], input[type=range], input[type=time]").forEach(t=>{o.timePoint?"checkbox"==t.type||"radio"==t.type?o.frames.push(["o",o.getXpathFromElement(t),o.getCSSPath(t),t.value,t.checked,0]):o.frames.push(["o",o.getXpathFromElement(t),o.getCSSPath(t),t.value,0]):"checkbox"==t.type||"radio"==t.type?o.frames.push(["o",o.getXpathFromElement(t),o.getCSSPath(t),t.value,t.checked]):o.frames.push(["o",o.getXpathFromElement(t),o.getCSSPath(t),t.value])})),this.curWindowResizeEventListener=this.windowResizeListener(function(t){o.frames.push(o.timePoint?t.concat((new Date).getTime()-1e3*o.startedAt):t),n instanceof Function&&n()}),window.addEventListener("resize",this.curWindowResizeEventListener,!0),window.onmousemove=this.moveListener(function(t){o.frames.push(o.timePoint?t.concat((new Date).getTime()-1e3*o.startedAt):t),n instanceof Function&&n()}),window.onmousedown=this.clickListener(function(t){o.frames.push(o.timePoint?t.concat((new Date).getTime()-1e3*o.startedAt):t),n instanceof Function&&n()}),window.onscroll=this.scrollListener(function(t){o.frames.push(o.timePoint?t.concat((new Date).getTime()-1e3*o.startedAt):t),n instanceof Function&&n()}),o.recordInputs&&(document.querySelectorAll("textarea, input[type=text], input[type=email], input[type=number], input[type=tel], input[type=search], input[type=url], input[type=search], input[type=week], input[type=month], input[type=datetime-local]").forEach(t=>{t.oninput=this.inputWithUserKeyListener(function(t){o.frames.push(o.timePoint?t.concat((new Date).getTime()-1e3*o.startedAt):t),n instanceof Function&&n()})}),document.querySelectorAll("select, input[type=checkbox], input[type=radio], input[type=color], input[type=date], input[type=file], input[type=number], input[type=range], input[type=time]").forEach(t=>{t.onchange=this.inputWithOnchangeListener(function(t){var e=o.getElementByXpath(t[1]);"checkbox"!=e.type&&"radio"!=e.type||(t=t.concat(e.checked)),o.frames.push(o.timePoint?t.concat((new Date).getTime()-1e3*o.startedAt):t),n instanceof Function&&n()})}),t=document.querySelector("body"),e={attributes:!0,attributeOldValue:!0,subtree:!0},i=window.MutationObserver||window.WebKitMutationObserver,this.observer=new i(this.mutationObserver(function(t){for(var e of t){var i;"attributes"==e.type&&(i=[],i=e.target.hasAttribute(e.attributeName)?["a",o.getXpathFromElement(e.target),o.getCSSPath(e.target),e.attributeName,e.target.getAttribute(e.attributeName),e.oldValue,"M"]:["a",o.getXpathFromElement(e.target),o.getCSSPath(e.target),e.attributeName,e.oldValue,"D"],o.frames.push(o.timePoint?i.concat((new Date).getTime()-1e3*o.startedAt):i),n instanceof Function)&&n()}})),this.observer.observe(t,e)),o.recording=!0)},stop:function(){this.finishedAt=(new Date).getTime()/1e3,window.removeEventListener("resize",this.curWindowResizeEventListener),this.curWindowResizeEventListener=null,window.onmousemove=this.onmousemove,window.onmousedown=this.onmousedown,window.onscroll=this.onscroll,this.inputWithUserKeyEvent(),this.inputWithOnchangeEvent(),""!=this.observer&&this.observer.disconnect(),this.timeouts=[],this.recording=!1,this.playing=!1,this.pos=0},pause:function(){this.playing&&(this.pos=this.currPos,this.playing=!1,this.clearTimeouts())},play:function(e){if(!this.playing){for(var i=this,n=(i.createCursor(),document.getElementById("musCursor")),t="";i.pos<i.frames.length;i.pos++)t=i.timePoint?i.frames[i.pos][i.frames[i.pos].length-1]:i.pos*i.playbackSpeed,i.timeouts.push(setTimeout(function(t){i.playFrame(i,i.frames[t],n),(i.currPos=t)==i.frames.length-1&&(n.style.backgroundColor="transparent",i.timeouts=[],i.playing=!1,i.pos=0,e)&&e()},t,i.pos));this.playing=!0}},release:function(){this.frames=[],this.startedAt=0,this.finishedAt=0,this.stop(),this.destroyCursor(),this.destroyClickSnapshot()},playFrame:function(t,e,i){try{var n,o,r,s,u;"m"==e[0]?(n=document.scrollingElement.scrollLeft,o=document.scrollingElement.scrollTop,i.style.left=n+100+t.getXCoordinate(e[1])+"px",i.style.top=o+t.getYCoordinate(e[2])+"px"):"c"==e[0]?(t.createClickSnapshot(e[2],e[1]),t.getElementByXpath(e[3]).click()):"s"==e[0]?window.scrollTo(e[1],e[2]):"S"==e[0]?(r=document.querySelector("div.parallellayout.col.main"),console.log(e),console.log(r),r.scrollTo(e[1],e[2])):"i"==e[0]?t.getElementByXpath(e[1]).value=e[3]:"o"==e[0]?"checkbox"==(s=t.getElementByXpath(e[1])).type||"radio"==s.type?s.checked=e[4]:s.value=e[3]:"a"==e[0]&&(u=t.getElementByXpath(e[1]),"M"==e[6]?u.setAttribute(e[3],e[4]):"D"==e[5]&&u.removeAttribute(e[3]))}catch(t){}},clearTimeouts:function(){for(var t in this.timeouts)clearTimeout(this.timeouts[t]);this.timeouts=[]},timeElapsed:function(){return this.finishedAt-this.startedAt},createCursor:function(){var t;document.getElementById("musCursor")||((t=document.createElement("div")).id="musCursor",t.style.position="absolute",t.style.width="32px",t.style.height="32px",t.style.borderRadius="32px",t.style.backgroundImage="url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IURPQ1RZUEUgc3ZnIFBVQkxJQyAiLS8vVzNDLy9EVEQgU1ZHIDEuMS8vRU4iICJodHRwOi8vd3d3LnczLm9yZy9HcmFwaGljcy9TVkcvMS4xL0RURC9zdmcxMS5kdGQiPjxzdmcgdmVyc2lvbj0iMS4xIiBpZD0iTGF5ZXJfMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiCSB2aWV3Qm94PSIwIDAgMjggMjgiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI4IDI4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cG9seWdvbiBmaWxsPSIjRkZGRkZGIiBwb2ludHM9IjguMiwyMC45IDguMiw0LjkgMTkuOCwxNi41IDEzLDE2LjUgMTIuNiwxNi42ICIvPjxwb2x5Z29uIGZpbGw9IiNGRkZGRkYiIHBvaW50cz0iMTcuMywyMS42IDEzLjcsMjMuMSA5LDEyIDEyLjcsMTAuNSAiLz48cmVjdCB4PSIxMi41IiB5PSIxMy42IiB0cmFuc2Zvcm09Im1hdHJpeCgwLjkyMjEgLTAuMzg3MSAwLjM4NzEgMC45MjIxIC01Ljc2MDUgNi41OTA5KSIgd2lkdGg9IjIiIGhlaWdodD0iOCIvPjxwb2x5Z29uIHBvaW50cz0iOS4yLDcuMyA5LjIsMTguNSAxMi4yLDE1LjYgMTIuNiwxNS41IDE3LjQsMTUuNSAiLz48L3N2Zz4=)",document.body.appendChild(t))},destroyCursor:function(){var t=document.getElementById("musCursor");t&&t.remove()},createClickSnapshot:function(t,e){var i=document.scrollingElement.scrollLeft,n=document.scrollingElement.scrollTop,o=document.createElement("div");o.className="musClickSnapshot",o.style.position="absolute",o.style.width="32px",o.style.height="32px",o.style.top=t+n+"px",o.style.left=e+i+"px",o.style.borderRadius="32px",o.style.backgroundColor="red",o.style.opacity=.2,document.body.appendChild(o)},destroyClickSnapshot:function(){for(var t=document.getElementsByClassName("musClickSnapshot");0<t.length;)t[0].remove()},getXCoordinate:function(t){return window.outerWidth>this.window.width?parseInt(this.window.width*t/window.outerWidth):parseInt(window.outerWidth*t/this.window.width)},getYCoordinate:function(t){return window.outerHeight>this.window.height?parseInt(this.window.height*t/window.outerHeight):parseInt(window.outerHeight*t/this.window.height)},getData:function(){return{frames:this.frames,timeElapsed:this.timeElapsed(),window:{width:window.outerWidth,height:window.outerHeight}}},isTimePoint:function(){return this.timePoint},setData:function(t){t.frames&&(this.frames=t.frames),t.window&&(this.window=t.window)},setFrames:function(t){this.frames=t},setWindowSize:function(t,e){this.window.width=t,this.window.height=e},setPlaybackSpeed:function(t){this.playbackSpeed=t},setTimePoint:function(t){this.timePoint=t},setRecordInputs:function(t){this.recordInputs=t},setRecordCurrentElem:function(t){this.recordCurrentElem=t},isRecording:function(){return this.recording},isPlaying:function(){return this.playing},speed:{SLOW:35,NORMAL:15,FAST:5},getCSSPath:function(t){let n=[];return $(t).parents().addBack().each((t,e)=>{e=$(e);let i=e.prop("tagName").toLowerCase();e.attr("id")&&(i+="#"+e.attr("id")),e.attr("class")&&(i+="."+e.attr("class").split(" ").join(".")),n.push(i)}),n.join(" ")},getXpathFromElement:function(t){document.getElementsByTagName("*");for(var e=[];t&&1==t.nodeType;t=t.parentNode){for(var i=1,n=t.previousSibling;n;n=n.previousSibling)n.localName==t.localName&&i++;e.unshift(t.localName.toLowerCase()+"["+i+"]")}return e.length?"/"+e.join("/"):null},getElementByXpath:function(t){return(new XPathEvaluator).evaluate(t,document.documentElement,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue}},t});